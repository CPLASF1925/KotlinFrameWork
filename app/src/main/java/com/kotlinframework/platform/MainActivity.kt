package com.kotlinframework.platformimport android.os.Bundleimport android.support.v7.widget.LinearLayoutManagerimport android.support.v7.widget.RecyclerViewimport android.view.Viewimport android.widget.Toastimport com.jcodecraeer.xrecyclerview.XRecyclerViewimport com.kotlinframework.platform.bean.ProductEntityimport com.kotlinframework.platform.bean.UserBeanimport com.kotlinframework.platform.contract.LoginContractimport com.kotlinframework.platform.contract.ProductContractimport com.kotlinframework.platform.presenter.LoginPresenterimport com.kotlinframework.platform.presenter.ProductPresenterimport com.trello.rxlifecycle2.components.support.RxAppCompatActivityimport kotlinx.android.synthetic.main.activity_main.*class MainActivity : RxAppCompatActivity(), View.OnClickListener, LoginContract.ILoginView,    ProductContract.IProductView, XRecyclerView.LoadingListener {    var page: Int = 1    lateinit var loginPresenter: LoginPresenter    lateinit var productPresenter: ProductPresenter    override fun onCreate(savedInstanceState: Bundle?) {        super.onCreate(savedInstanceState)        setContentView(R.layout.activity_main)        initView()        initData()    }    private fun initData() {        loginPresenter = LoginPresenter()        productPresenter = ProductPresenter()    }    /**     * 初始化view     */    private fun initView() {        login.setOnClickListener(this)        getMovies.setOnClickListener(this)        xrv.layoutManager = LinearLayoutManager(this)        xrv.setLoadingListener(this)        xrv.setLoadingMoreEnabled(true)    }    /**     * 登录测试     */    fun login() {        var params = HashMap<String, String>()        params.put("phone", "18612991023")        params.put("pwd", "111111")        loginPresenter.attach(this)        loginPresenter.login(params, this)    }    /**     * 获取影片列表     */    private fun getMovies() {        var params = HashMap<String, String>()        params.put("keyword", "电脑")        params.put("page", page.toString())        params.put("count", "1")        productPresenter.attach(this)        productPresenter.getProducts(params, this)    }    override fun success(userBean: UserBean) {        Toast.makeText(this, userBean.result.phone, Toast.LENGTH_SHORT).show()    }    override fun failure(string: String) {        Toast.makeText(this, string, Toast.LENGTH_SHORT).show()    }    /**     * 商品列表     */    override fun success(productEntity: ProductEntity) {        if (page == 1)            xrv.adapter = ProductAdapter(this, productEntity.result)        else            xrv.adapter?.notifyDataSetChanged()        xrv.refreshComplete()        xrv.loadMoreComplete()    }    override fun onDestroy() {        super.onDestroy()        loginPresenter.detach()        productPresenter.detach()    }    /**     * 点击事件     */    override fun onClick(v: View?) {        when (v!!.id) {            R.id.login -> login()            R.id.getMovies -> getMovies()        }    }    /**     * 分页     */    override fun onLoadMore() {        page++        getMovies()    }    /**     * 下拉刷新     */    override fun onRefresh() {        page = 1        getMovies()    }}